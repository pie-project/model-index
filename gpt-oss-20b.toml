# Model metadata
name = "gpt-oss-20b"
description = "GPT OSS 20B Model"
version = "1.0"
parameters = ["gpt-oss-20b.zt"]

# Model architecture details
[architecture]
type = "gptoss"
num_layers = 24
num_query_heads = 64
num_key_value_heads = 8
head_size = 64
hidden_size = 2880
intermediate_size = 2880
vocab_size = 201088
use_qkv_bias = true
rms_norm_eps = 1e-5
initial_context_length = 4096
max_position_embeddings = 131072
sliding_window = 128
swiglu_limit = 7.0

[architecture.moe]
num_experts = 32
experts_per_token = 4

[architecture.rope]
theta = 150000.0
scaling_factor = 32.0
ntk_alpha = 1.0
ntk_beta = 32.0

# Tokenizer configuration
[tokenizer]
type = "bpe"
vocabulary_file = "gpt-oss.vocab"
split_regex = "[^\\r\\n\\p{L}\\p{N}]?[\\p{Lu}\\p{Lt}\\p{Lm}\\p{Lo}\\p{M}]*[\\p{Ll}\\p{Lm}\\p{Lo}\\p{M}]+(?i:'s|'t|'re|'ve|'m|'ll|'d)?|[^\\r\\n\\p{L}\\p{N}]?[\\p{Lu}\\p{Lt}\\p{Lm}\\p{Lo}\\p{M}]+[\\p{Ll}\\p{Lm}\\p{Lo}\\p{M}]*(?i:'s|'t|'re|'ve|'m|'ll|'d)?|\\p{N}{1,3}| ?[^\\s\\p{L}\\p{N}]+[\\r\\n/]*|\\s*[\\r\\n]+|\\s+(?!\\S)|\\s+"
escape_non_printable = true

[tokenizer.special_tokens]
"<|startoftext|>" = 199998
"<|endoftext|>" = 199999
"<|reserved_200000|>" = 200000
"<|reserved_200001|>" = 200001
"<|return|>" = 200002
"<|constrain|>" = 200003
"<|reserved_200004|>" = 200004
"<|channel|>" = 200005
"<|start|>" = 200006
"<|end|>" = 200007
"<|message|>" = 200008
"<|reserved_200009|>" = 200009
"<|reserved_200010|>" = 200010
"<|reserved_200011|>" = 200011
"<|call|>" = 200012
"<|reserved_200013|>" = 200013
"<|reserved_200014|>" = 200014
"<|reserved_200015|>" = 200015
"<|reserved_200016|>" = 200016
"<|reserved_200017|>" = 200017
"<|endofprompt|>" = 200018

# Prompt template configuration
[template]
type = "ninja"
content = """
{# ----- Minimal MiniJinja chat template (no tools, no helpers) ----- #}

{# System header (optional model_identity/current_date) #}
<|start|>system<|message|>
{% if model_identity is defined and model_identity %}
{{ model_identity }}
{% else %}
You are ChatGPT, a large language model.
{% endif %}
{% if current_date is defined and current_date %}
Current date: {{ current_date }}
{% endif %}
<|end|>

{# Developer message (optional) #}
{% if developer_instructions is defined and developer_instructions %}
<|start|>developer<|message|>{{ developer_instructions }}<|end|>
{% endif %}

{# Conversation turns #}
{% for m in messages %}
  {% if m.role == "user" and m.content is defined %}
<|start|>user<|message|>{{ m.content }}<|end|>
  {% elif m.role == "assistant" and m.content is defined %}
<|start|>assistant<|channel|>final<|message|>{{ m.content }}<|end|>
  {% elif m.role == "system" and m.content is defined %}
<|start|>system<|message|>{{ m.content }}<|end|>
  {% endif %}
{% endfor %}

{# Generation prompt for next turn #}
{% if add_generation_prompt %}
<|start|>assistant
{% endif %}
"""
stop_tokens = ["<|endoftext|>", "<|return|>", "<|call|>"]

[source]
"gpt-oss-20b.zt" = "https://huggingface.co/pie-project/gpt-oss-20b/resolve/main/gpt-oss-20b.zt"
"gpt-oss.vocab" = "https://huggingface.co/pie-project/gpt-oss-20b/resolve/main/gpt-oss.vocab"
